use Structure;

bundle Default {
	class CallbackHolder {
		@callback : (GtkWidget, GdkEvent) ~ Nil;

		New(callback : (GtkWidget, GdkEvent) ~ Nil) {
			@callback := callback;
		}

		method : public : Get() ~ (GtkWidget, GdkEvent) ~ Nil {
			return @callback;
		}
	}
	class GtkWidget {
		native_ptr : Int;

		New() {
		}

		method : public : SignalConnect(name : String, callback : (GtkWidget, GdkEvent) ~ Nil) ~ Nil {
			lib_proxy := DllProxy->New("lib/linux64/gtk2_objk.so.1.0.1");
         array_args := Base->New[3];
         array_args[0] := IntHolder->New(native_ptr);
         array_args[1] := name;
         array_args[2] := CallbackHolder->New(callback);
         lib_proxy->CallFunction("signal_connect", array_args);
		}

		method : public : Show() ~ Nil {
			lib_proxy := DllProxy->New("lib/linux64/gtk2_objk.so.1.0.1");
         array_args := Base->New[1];
         array_args[0] := IntHolder->New(native_ptr);
         lib_proxy->CallFunction("g_widget_show", array_args);
		}

	}

	class GdkEvent {
		New() {
		}
	}

	class GtkWindow from GtkWidget {
		New() {
			Parent();

			lib_proxy := DllProxy->New("lib/linux64/gtk2_objk.so.1.0.1");
         array_args := Base->New[1];
         array_args[0] := IntHolder->New(0);
         lib_proxy->CallFunction("g_window_new", array_args);
			ptr_holder := array_args[0]->As(IntHolder);
			native_ptr := ptr_holder->Get();
		}
		
		method : public : Main() ~ Nil {
			lib_proxy := DllProxy->New("lib/linux64/gtk2_objk.so.1.0.1");
         lib_proxy->CallFunction("g_main", Nil->As(Base[]));
		}
	}

	class Gtk2 {
		function : DeleteEvent(widget : GtkWidget, event : GdkEvent) ~ Nil {
		}

		function : Main(args : String[]) ~ Nil {
			window := GtkWindow->New();	
			f := DeleteEvent(GtkWidget, GdkEvent) ~ Nil;
			window->SignalConnect("destory", f);
			window->Show();
			window->Main();
		}
	}
}
