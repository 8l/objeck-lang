use ODBC;
use Structure;

bundle Default {
	class SqlTest {
		function : Main(args : String[]) ~ Nil {
			Run();
		}

		function : native : Run() ~ Nil {
			conn := Connection->New("test", "root", "");	
			if(conn <> Nil) {
#~
				pstmt := conn->CreateParameterStatement("UPDATE test.student SET first_name=?, credits=? WHERE id=?");
				pstmt->SetString(1, "randy");
				pstmt->SetInt(2, 512);
				pstmt->SetInt(3, 3);
				pstmt->Update()->PrintLine();
				pstmt->Close();
#				conn->Update("UPDATE test.student SET last_name='dog' WHERE id=2")->PrintLine();
~#
				result := conn->Select("select * from test.student where id=2");
				if(result <> Nil) {
					i := 0;	
					while(result->Next()) {
						result->GetInt(1)->PrintLine();
						result->GetString(3)->PrintLine();
						ts := result->GetTimestamp(5);
						ts->GetYear()->PrintLine();
						result->GetFloat(6)->PrintLine();
						result->GetBit(7)->PrintLine();
						i += 1;
					};
					i->PrintLine();	
					result->Close();
				};
				conn->Close();
			};
		}
	}
}
