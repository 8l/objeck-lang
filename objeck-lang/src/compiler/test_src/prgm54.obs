use Net;

bundle Default {
	class SocketTest {
		function : Main(args : System.String[]), Nil {
			address := "www.mscd.edu";

			socket := TCPSocket->New(address, 80);
			if(socket->IsOpen()) {
				get := "GET / HTTP/1.1\r\nHost: ";
				get->Append(address);
				get->Append("\r\n\r\n");
				socket->WriteString(get);

				line := socket->ReadString();
				while(line->GetSize() > 0) {	
					trim := line->Trim();
					start : Int;
					for(i := 0; i < trim->GetSize(); i := i + 1;) {
						# find tag start
						if(trim->GetChar(i) = '<') {
							start := i;
						};

						# find tag end
						if(trim->GetChar(i) = '>') {
							len := i - start;
							# print tag
							if(len > 0) {
								trim->SubString(start, len + 1)->PrintLine();
							};
						};
						
					};
					line := socket->ReadString();
				};
				socket->Close();
			}
			else {
				error := "unable to connect to: ";
				error->Append(address);
				error->PrintLine();
			};
		}
	}
}
